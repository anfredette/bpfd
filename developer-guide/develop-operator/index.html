
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/bpd_icon.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.6">
    
    
      
        <title>Developing the bpfd-operator - bpfd</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developing-the-bpfd-operator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="bpfd" class="md-header__button md-logo" aria-label="bpfd" data-md-component="logo">
      
  <img src="../../img/bpfd_icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            bpfd
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developing the bpfd-operator
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bpfd-dev/bpfd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/building-bpfd/" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../governance/CONTRIBUTING/" class="md-tabs__link md-tabs__link--active">
        Developer Guide
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../governance/MEETINGS/" class="md-tabs__link">
        Community
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="bpfd" class="md-nav__button md-logo" aria-label="bpfd" data-md-component="logo">
      
  <img src="../../img/bpfd_icon.svg" alt="logo">

    </a>
    bpfd
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bpfd-dev/bpfd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/building-bpfd/" class="md-nav__link">
        Setup and Building
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/tutorial/" class="md-nav__link">
        Bpfd on Linux Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/bpfctl-guide/" class="md-nav__link">
        bpfctl Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/example-bpf/" class="md-nav__link">
        Example eBPF Programs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/example-bpf-local/" class="md-nav__link">
        Deploying Example eBPF Programs On Local Host
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/example-bpf-k8s/" class="md-nav__link">
        Deploying Example eBPF Programs On Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/REVIEWING/" class="md-nav__link">
        Reviewing Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../operator-quick-start/" class="md-nav__link">
        Deploying the bpfd-operator
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Developing the bpfd-operator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Developing the bpfd-operator
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-design-overview" class="md-nav__link">
    High level design overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-deploying" class="md-nav__link">
    Building and deploying
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-locally-in-kind" class="md-nav__link">
    Running Locally in KIND
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-locally" class="md-nav__link">
    Testing Locally
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    Project Layout
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api-spec/" class="md-nav__link">
        Kubernetes CRD API-Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shipping-bytecode/" class="md-nav__link">
        eBPF Bytecode Image Specifications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image-build/" class="md-nav__link">
        bpfd Container Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linux-capabilities/" class="md-nav__link">
        Linux Capabilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/MEETINGS/" class="md-nav__link">
        Meetings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/GOVERNANCE/" class="md-nav__link">
        Governance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/CODE_OF_CONDUCT/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/MAINTAINERS/" class="md-nav__link">
        Maintainers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/SECURITY/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-design-overview" class="md-nav__link">
    High level design overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-deploying" class="md-nav__link">
    Building and deploying
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-locally-in-kind" class="md-nav__link">
    Running Locally in KIND
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-locally" class="md-nav__link">
    Testing Locally
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    Project Layout
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/bpfd-dev/bpfd/edit/main/docs/developer-guide/develop-operator.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="developing-the-bpfd-operator">Developing the bpfd-operator</h1>
<p>This section is intended to give developer level details regarding the layout and design of the bpfd-operator.
At its core the operator was implemented using the <a href="https://sdk.operatorframework.io/">operator-sdk framework</a>
which make those docs another good resource if anything is missed here.</p>
<h2 id="high-level-design-overview">High level design overview</h2>
<p>This repository houses two main processes, the <code>bpfd-agent</code> and the <code>bpfd-operator</code> along with CRD api definitions
for <code>BpfProgram</code> and <code>*Program</code> Objects.
The following diagram depicts how all these components work together to create a functioning operator.</p>
<p><img alt="bpfd on K8s" src="../../img/bpfd-on-k8s.png" /></p>
<h2 id="building-and-deploying">Building and deploying</h2>
<p>For building and deploying the bpfd-operator simply see the attached <code>Make help</code>
output.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a> make <span class="nb">help</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Usage:
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  make &lt;target&gt;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>General
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>  <span class="nb">help</span>             Display this help.
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>Local Dependencies
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>  kustomize        Download kustomize locally <span class="k">if</span> necessary.
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>  cm-verifier      Download cm-verifier locally <span class="k">if</span> necessary.
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>  controller-gen   Download controller-gen locally <span class="k">if</span> necessary.
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>  envtest          Download envtest-setup locally <span class="k">if</span> necessary.
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>  opm              Download opm locally <span class="k">if</span> necessary.
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>Development
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>  manifests        Generate WebhookConfiguration, ClusterRole and CustomResourceDefinition objects.
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>  generate         Generate ALL auto-generated code.
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>  generate-register  Generate register code see all <span class="sb">`</span>zz_generated.register.go<span class="sb">`</span> files.
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>  generate-deepcopy  Generate code containing DeepCopy, DeepCopyInto, and DeepCopyObject method implementations see all <span class="sb">`</span>zz_generated.register.go<span class="sb">`</span> files.
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>  generate-typed-clients  Generate typed client code
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>  generate-typed-listers  Generate typed listers code
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>  generate-typed-informers  Generate typed informers code
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>  fmt              Run go fmt against code.
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>  verify           Verify all the autogenerated code
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>  lint             Run golang-ci linter
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>  <span class="nb">test</span>             Run Unit tests.
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>  test-integration  Run Integration tests.
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>  bundle           Generate bundle manifests and metadata, <span class="k">then</span> validate generated files.
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>Build
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>  build            Build bpfd-operator and bpfd-agent binaries.
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>  build-images     Build bpfd, bpfd-agent, and bpfd-operator images.
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>  push-images      Push bpfd, bpfd-agent, bpfd-operator images.
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>  load-images-kind  Load bpfd, bpfd-agent, and bpfd-operator images into the running <span class="nb">local</span> kind devel cluster.
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>  bundle-build     Build the bundle image.
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>  bundle-push      Push the bundle image.
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>  catalog-build    Build a catalog image.
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>  catalog-push     Push a catalog image.
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>CRD Deployment
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>  install          Install CRDs into the K8s cluster specified <span class="k">in</span> ~/.kube/config.
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>  uninstall        Uninstall CRDs from the K8s cluster specified <span class="k">in</span> ~/.kube/config. Call with ignore-not-found<span class="o">=</span><span class="nb">true</span> to ignore resource not found errors during deletion.
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>Deployment Dependencies
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>  deploy-certmanager  Deploy certmanager to the cluster specified <span class="k">in</span> ~/.kube/config.
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>  undeploy-certmanager  Undeploy certmanager from the cluster specified <span class="k">in</span> ~/.kube/config. Call with ignore-not-found<span class="o">=</span><span class="nb">true</span> to ignore resource not found errors during deletion.
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>Vanilla K8s Deployment
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>  setup-kind       Setup Kind cluster with certmanager ready <span class="k">for</span> bpfd deployment
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>  deploy           Deploy bpfd-operator to the K8s cluster specified <span class="k">in</span> ~/.kube/config.
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>  undeploy         Undeploy bpfd-operator from the K8s cluster specified <span class="k">in</span> ~/.kube/config. Call with ignore-not-found<span class="o">=</span><span class="nb">true</span> to ignore resource not found errors during deletion.
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>  kind-reload-images  Reload locally build images into a kind cluster and restart the ds and deployment so they<span class="err">&#39;</span>re picked up.
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>  run-on-kind      Kind Deploy runs the bpfd-operator on a <span class="nb">local</span> kind cluster using <span class="nb">local</span> builds of bpfd, bpfd-agent, and bpfd-operator
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>Openshift Deployment
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>  deploy-openshift  Deploy bpfd-operator to the Openshift cluster specified <span class="k">in</span> ~/.kube/config.
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>  undeploy-openshift  Undeploy bpfd-operator from the Openshift cluster specified <span class="k">in</span> ~/.kube/config. Call with ignore-not-found<span class="o">=</span><span class="nb">true</span> to ignore resource not found errors during deletion.
</code></pre></div>
<h2 id="running-locally-in-kind">Running Locally in KIND</h2>
<p>To run locally in a kind cluster with an up to date build simply run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>make run-on-kind
</code></pre></div>
<p>The container images used for <code>bpfd</code>,<code>bpfd-agent</code>, and <code>bpfd-operator</code> can also be manually configured,
by default local image builds will be used for the kind deployment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">BPFD_IMG</span><span class="o">=</span>&lt;your/image/url&gt; <span class="nv">BPFD_AGENT_IMG</span><span class="o">=</span>&lt;your/image/url&gt; <span class="nv">BPFD_OPERATOR_IMG</span><span class="o">=</span>&lt;your/image/url&gt; make run-on-kind
</code></pre></div>
<p>Then rebuild and load a fresh build run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>make kind-reload-images
</code></pre></div>
<p>Which will rebuild the bpfd-operator, bpfd-agent, and bpfd images and load them into the kind cluster.</p>
<h2 id="testing-locally">Testing Locally</h2>
<p>To run all of the <strong>Unit Tests</strong> defined in the bpfd-operator controller code simply run <code>make test</code>.</p>
<p>To run <strong>Integration Tests</strong> locally:</p>
<ol>
<li>Build the images locally with the <code>int-test</code> tag.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>    <span class="nv">BPFD_AGENT_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd-agent:int-test <span class="nv">BPFD_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd:int-test <span class="nv">BPFD_OPERATOR_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd-operator:int-test make build-images
</code></pre></div>
<ol>
<li>Run the integration test suite.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>    <span class="nv">BPFD_AGENT_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd-agent:int-test <span class="nv">BPFD_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd:int-test <span class="nv">BPFD_OPERATOR_IMG</span><span class="o">=</span>quay.io/bpfd/bpfd-operator:int-test make test-integration
</code></pre></div>
<p>Additionally the integration test can be configured with the following environment variables:</p>
<ul>
<li><strong>KEEP_TEST_CLUSTER</strong>: If set to <code>true</code> the test cluster will not be torn down after the integration test
  suite completes.</li>
<li><strong>USE_EXISTING_KIND_CLUSTER</strong>: If this is set to the name of the existing kind cluster the integration test
  suite will use that cluster instead of creating a new one.</li>
</ul>
<h2 id="project-layout">Project Layout</h2>
<p>The bpfd-operator project layout is guided by the recommendations from both the
<a href="https://sdk.operatorframework.io/docs/building-operators/golang/tutorial/#project-layout">operator-sdk framework</a>
and the <a href="https://github.com/golang-standards/project-layout">standard golang project-layout</a>.
The following is a brief description of the main directories and their contents.</p>
<p><strong>NOTE: Bolded directories contain auto-generated code</strong></p>
<ul>
<li><strong><code>/apis</code></strong>: Contains the K8s CRD api definitions(<code>*_types.go</code>) for each version along with the
  auto-generated register and deepcopy methods(<code>zz_generated.deepcopy.go</code> and <code>zz_generate_register.go</code>).</li>
<li><code>/bundle</code>: Contains the OLM bundle manifests and metadata for the operator.
  More details can be found in the operator-sdk documentation.</li>
<li><code>/cmd</code>: Contains the main entry-points for the bpfd-operator and bpfd-agent processes.</li>
<li><code>/config</code>: Contains the configuration files for launching the bpfd-operator on a cluster.<ul>
<li><code>/bpfd-deployment</code>: Contains static deployment yamls for the bpfd-daemon, this includes two containers,
  one for <code>bpfd</code> and the other for the <code>bpfd-agent</code>.
  This DaemonSet yaml is NOT deployed statically by kustomize, instead it's statically copied into the operator
  image which is then responsible for deploying and configuring the bpfd-daemon DaemonSet.
  Lastly, this directory also contains the default config used to configure the bpfd-daemon, along with the
  cert-manager certificates used to encrypt communication between the bpfd-agent and bpfd.</li>
<li><code>/bpfd-operator-deployment:</code> Contains the static deployment yaml for the bpfd-operator. This is deployed
  statically by kustomize.</li>
<li><code>/cert-manager</code>: Contains the cert-manager manifests used to deploy cert-manager to a cluster.
  Specifically it just contains a symlink to it's manifests locking us into a specific version.</li>
<li><code>/crd</code>: Contains the CRD manifests for all of the bpfd-operator APIs.<ul>
<li><strong><code>/bases</code></strong>: Is where the actual CRD definitions are stored.
These definitions are auto-generated by <a href="https://book.kubebuilder.io/reference/controller-gen.html">controller-gen</a>.</li>
</ul>
</li>
<li><code>/default</code>: Contains the default deployment configuration for the bpfd-operator.</li>
<li><code>/manifests</code>: Contains the bases for generating OLM manifests.</li>
<li><code>/openshift</code>: Contains the Openshift specific deployment configuration for the bpfd-operator.</li>
<li><code>/prometheus</code>: Contains the prometheus manifests used to deploy Prometheus to a cluster.
  At the time of writing this the bpfd-operator is NOT exposing any metrics to prometheus, but this is a future goal.</li>
<li><strong><code>/rbac</code></strong>: Contains rbac yamls for getting bpfd and the bpfd-operator up and running on Kubernetes.
    <strong><code>/bpfd-agent</code></strong>: Contains the rbac yamls for the bpfd-agent.
    They are automatically generated by kubebuilder via build tags in the bpfd-agent controller code.
    <strong><code>/bpfd-operator</code></strong>: Contains the rbac yamls for the bpfd-operator.
    They are automatically generated by kubebuilder via build tags in the bpfd-operator controller code.</li>
<li><code>/samples</code>: Contains sample CR definitions that can be deployed by users for each of our supported APIs.</li>
<li><code>/scorecard</code>: Contains the scorecard manifests used to deploy scorecard to a cluster. At the time of writing
  this the bpfd-operator is NOT running any scorecard tests.</li>
<li><code>/test</code>: Contains the test manifests used to deploy the bpfd-operator to a kind cluster for integration testing.</li>
</ul>
</li>
<li><code>/controllers</code>: Contains the controller implementations for all of the bpfd-operator APIs.
  Each controller is responsible for reconciling the state of the cluster with the desired state defined by the user.
  This is where the source of truth for the auto-generated RBAC can be found, keep an eye out for
  <code>//+kubebuilder:rbac:groups=bpfd.io</code> comment tags.<ul>
<li><code>/bpfdagent</code>: Contains the controller implementations which reconcile user created <code>*Program</code> types to multiple
  <code>BpfProgram</code> objects.</li>
<li><code>/bpfdoperator</code>: Contains the controller implementations which reconcile global <code>BpfProgram</code> object state back to
  the user by ensuring the user created <code>*Program</code> objects are reporting the correct status.</li>
</ul>
</li>
<li><code>/hack</code>: Contains any scripts+static files used by the bpfd-operator to facilitate development.</li>
<li><code>/internal</code>: Contains all private library code and is used by the bpfd-operator and bpfd-agent controllers.</li>
<li><strong><code>/pkg</code></strong>: Contains all public library code this is consumed externally and internally.<ul>
<li><strong><code>/client</code></strong>: Contains the autogenerated clientset, informers and listers for all of the bpfd-operator APIs.
  These are autogenerated by the <a href="https://github.com/kubernetes/code-generator">k8s.io/code-generator project</a>,
  and can be consumed by users wishing to programmatically interact with bpfd specific APIs.</li>
<li><code>/helpers</code>: Contains helper functions which can be consumed by users wishing to programmatically interact with
  bpfd specific APIs.</li>
</ul>
</li>
<li><code>/test/integration</code>: Contains integration tests for the bpfd-operator.
  These tests are run against a kind cluster and are responsible for testing the bpfd-operator in a real cluster
  environment.
  It uses the <a href="https://github.com/Kong/kubernetes-testing-framework">kubernetes-testing-framework project</a> to
  programmatically spin-up all of the required infrastructure for our unit tests.</li>
<li><code>Makefile</code>: Contains all of the make targets used to build, test, and generate code used by the bpfd-operator.</li>
</ul>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../operator-quick-start/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Deploying the bpfd-operator" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deploying the bpfd-operator
            </div>
          </div>
        </a>
      
      
        
        <a href="../api-spec/" class="md-footer__link md-footer__link--next" aria-label="Next: Kubernetes CRD API-Reference" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Kubernetes CRD API-Reference
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-2023 The bpfd contributors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.85cb4492.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a877e258.min.js"></script>
      
    
  </body>
</html>